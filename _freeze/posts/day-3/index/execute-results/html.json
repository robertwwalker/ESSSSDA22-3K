{
  "hash": "80b2d2b6db61fa1f71b1bf65440872cb",
  "result": {
    "markdown": "---\ntitle: \"Day 3: Dynamic Linear, ADL Models, and VARs\"\nauthor: \"Robert W. Walker\"\ndate: \"08/10/2022\"\ncategories: [time series, code, analysis]\nimage: \"image.png\"\n---\n\n\n## Slides\n\n- [Slides in .pdf format](./slides/slidesDay3.pdf)\n- [A xaringan for presentation](./slides/ESSSSDA22-Day3/)\n\n## Dynamic Regression\n\nRegression techniques can be reexamined through the lens of dynamic linear models and systems of linear equations.  Whether autoregressive distributed lag models or VAR systems and structural time series, regression approaches to time series almost inevitably culminate in thinking about causation as conceived by Clive Granger -- Granger causality.\n\nToday we cover chapters 3 and 4 in **TSASS** spanning dynamic regression models and dynamic systems.  We will start with dynamic regression models by detailing how they are specified and interpreted with distributed lag and autoregressive distributed lag [ADL] models.  We also examine the crucial issue of consistency before turning to structural time series models for multiple equations and their counterparts -- VARs. \n\n\n\n\n\n## VARs\n\nWe will start with some data on lung deaths from Australia.\n\n```\nlibrary(forecast)\nmdeaths\nfdeaths\nsave(mdeaths, fdeaths, file = \"./img/LungDeaths.RData\")\n```\n\n```\nuse \"https://github.com/robertwwalker/Essex-Data/raw/main/Lung-Deaths.dta\"\n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(hrbrthemes); library(fpp3)\nload(url(\"https://github.com/robertwwalker/Essex-Data/raw/main/LungDeaths.RData\"))\nMales <- mdeaths; Females <- fdeaths\nLung.Deaths <- cbind(Males, Females) %>% as_tsibble()\nLung.Deaths %>% autoplot() + theme_ipsum_rc() + labs(y=\"Lung Deaths\", x=\"Month [1M]\", title=\"Lung Deaths among Males and Females\") + guides(color=\"none\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png){width=100%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlung_deaths <- cbind(mdeaths, fdeaths) %>%\n  as_tsibble(pivot_longer = FALSE)\nlung_deaths <- cbind(mdeaths, fdeaths) %>%\n  as_tsibble(pivot_longer = FALSE)\nfit <- lung_deaths %>%\n  model(VAR(vars(mdeaths, fdeaths) ~ AR(3)))\nreport(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSeries: mdeaths, fdeaths \nModel: VAR(3) w/ mean \n\nCoefficients for mdeaths:\n      lag(mdeaths,1)  lag(fdeaths,1)  lag(mdeaths,2)  lag(fdeaths,2)\n              0.6675          0.8074          0.3677         -1.4540\ns.e.          0.3550          0.8347          0.3525          0.8088\n      lag(mdeaths,3)  lag(fdeaths,3)  constant\n              0.2606         -1.1214  538.7817\ns.e.          0.3424          0.8143  137.1047\n\nCoefficients for fdeaths:\n      lag(mdeaths,1)  lag(fdeaths,1)  lag(mdeaths,2)  lag(fdeaths,2)\n              0.2138          0.4563          0.0937         -0.3984\ns.e.          0.1460          0.3434          0.1450          0.3328\n      lag(mdeaths,3)  lag(fdeaths,3)  constant\n              0.0250          -0.315  202.0027\ns.e.          0.1409           0.335   56.4065\n\nResidual covariance matrix:\n         mdeaths  fdeaths\nmdeaths 58985.95 22747.94\nfdeaths 22747.94  9983.95\n\nlog likelihood = -812.35\nAIC = 1660.69\tAICc = 1674.37\tBIC = 1700.9\n```\n:::\n:::\n\n\n```\nvar mdeaths fdeaths, lags(1 2 3)  \n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit2 <- lung_deaths %>%\n  model(VAR(vars(mdeaths, fdeaths) ~ AR(2)))\nreport(fit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSeries: mdeaths, fdeaths \nModel: VAR(2) w/ mean \n\nCoefficients for mdeaths:\n      lag(mdeaths,1)  lag(fdeaths,1)  lag(mdeaths,2)  lag(fdeaths,2)  constant\n              0.9610          0.3340          0.1149         -1.3379  443.8492\ns.e.          0.3409          0.8252          0.3410          0.7922  124.4608\n\nCoefficients for fdeaths:\n      lag(mdeaths,1)  lag(fdeaths,1)  lag(mdeaths,2)  lag(fdeaths,2)  constant\n              0.3391          0.2617         -0.0601         -0.2691  145.0546\ns.e.          0.1450          0.3510          0.1450          0.3369   52.9324\n\nResidual covariance matrix:\n         mdeaths  fdeaths\nmdeaths 62599.51 24942.79\nfdeaths 24942.79 11322.70\n\nlog likelihood = -833.17\nAIC = 1694.35\tAICc = 1701.98\tBIC = 1725.83\n```\n:::\n:::\n\n\n```\nvar mdeaths fdeaths, lags(1 2)  \n```\n\nGranger causation wants a non-tidy format.  I will use the conventional `VAR` syntax from `vars` that wants the collection of endogenous variables as inputs by themselves in a matrix form.  We can also specify exogenous variable for such systems with their data matrix in the argument `exogen=...`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(bruceR)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nbruceR (version 0.8.8)\nBRoadly Useful Convenient and Efficient R functions\n\nPackages also loaded:\n√ dplyr     \t√ emmeans     \t√ ggplot2\n√ tidyr     \t√ effectsize  \t√ ggtext\n√ stringr   \t√ performance \t√ cowplot\n√ forcats   \t√ lmerTest    \t√ see\n√ data.table\n\nMain functions of `bruceR`:\ncc()          \tDescribe() \tTTEST()\nadd()         \tFreq()     \tMANOVA()\n.mean()       \tCorr()     \tEMMEANS()\nset.wd()      \tAlpha()    \tPROCESS()\nimport()      \tEFA()      \tmodel_summary()\nprint_table() \tCFA()      \tlavaan_summary()\n\nhttps://psychbruce.github.io/bruceR/\n```\n:::\n\n```{.r .cell-code}\nVarmf <- vars::VAR(lung_deaths[,c(\"mdeaths\",\"fdeaths\")], p=3, type=\"const\")\ngranger_causality(Varmf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nGranger Causality Test (Multivariate)\n\nF test and Wald χ² test based on VAR(3) model:\n────────────────────────────────────────────────────────────────\n                          F df1 df2     p     Chisq df     p    \n────────────────────────────────────────────────────────────────\n ------------------                                             \n mdeaths <= fdeaths    1.93   3  62  .134      5.80  3  .122    \n mdeaths <= ALL        1.93   3  62  .134      5.80  3  .122    \n ------------------                                             \n fdeaths <= mdeaths    1.20   3  62  .316      3.61  3  .307    \n fdeaths <= ALL        1.20   3  62  .316      3.61  3  .307    \n────────────────────────────────────────────────────────────────\n```\n:::\n:::\n\n\n```\nvargranger\n```\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit %>%\n  fabletools::forecast(h=12) %>%\n  autoplot(lung_deaths)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=100%}\n:::\n:::\n\n\n\n\n### Female\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlung_deaths %>%\nmodel(VAR(vars(mdeaths, fdeaths) ~ AR(3))) %>%\n  residuals() %>% \n  pivot_longer(., cols = c(mdeaths,fdeaths)) %>% \n  filter(name==\"fdeaths\") %>% \n  as_tsibble(index=index) %>% \n  gg_tsdisplay(plot_type = \"partial\") + labs(title=\"Female residuals\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=100%}\n:::\n:::\n\n\n### Male\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlung_deaths %>%\nmodel(VAR(vars(mdeaths, fdeaths) ~ AR(3))) %>%\n  residuals() %>% \n  pivot_longer(., cols = c(mdeaths,fdeaths)) %>% \n  filter(name==\"mdeaths\") %>% \n  as_tsibble(index=index) %>% \n  gg_tsdisplay(plot_type = \"partial\") + labs(title=\"Male residuals\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=100%}\n:::\n:::\n\n\n\n## Easy Impulse Response\n\n**What happens if I shock one of the series; how does it work through the system?**  \n\nThe idea behind an impulse-response is core to counterfactual analysis with time series.  What does our future world look like and what predictions arise from it and the model we have deployed?\n\n\nWhether VARs or dynamic linear models or ADL models, these are key to interpreting a model **in the real world**.\n\n\n### Males\n\n\n::: {.cell}\n\n```{.r .cell-code}\nVARMF <- cbind(Males,Females)\nmod1 <- vars::VAR(VARMF, p=3, type=\"const\")\nplot(vars::irf(mod1, boot=TRUE, impulse=\"Males\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=100%}\n:::\n:::\n\n\n\n### Females\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(vars::irf(mod1, boot=TRUE, impulse=\"Females\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=100%}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}